# DIMP
Decentralized Instant Messaging Protocol

## 0. Summary
This protocol is designed for instant messaging. It includes just TWO parts:

1. Account
2. Message

## 1. Account

### 1.0. Meta
The 'Meta' was generated by your private key,
it can be used to build a new ID for entity, or verify the ID/PK pair.

The 'Meta' consists of 4 fields:

| Field       | Description                   |
| ----------- | ----------------------------- |
| version     | Meta Algorithm Version        |
| seed        | Entity Name                   |
| key         | Public Key                    |
| fingerprint | Signature to generate address |

THe 'fingerprint' field was calculate by your private key and 'seed':

````
fingerprint = sign(seed, SK);
````

### 1.1. ID
The 'ID' is used to identify an entity. It consists of 3 fields:

| Field       | Description                   |
| ----------- | ----------------------------- |
| name        | Same with meta.seed           |
| address     | Unique Identification         |
| terminal    | Login point, it's optional.   |

And the most common format is 'Name@Address'.

#### Name
The 'Name' field is an entity name (username, or just a random string for group).

You can use any 'C' type variable naming string here.

```
name = "moky";
```

#### Address
The 'Address' field was created by the 'Meta' info and the network ID:

1. MKMNetwork_Main (a person)
2. MKMNetwork_Polylogue (a group)

````
// address algorithm
function HASH(fingerprint, network) {
    CT      = fingerprint;
    hash    = ripemd160(sha256(CT));
    code    = sha256(sha256(network+hash)).prefix(4); // check code
    address = base58(network+hash+code);
}
````

### 1.2. Public Key
A 'PK' (public key) was binding to an ID by the Meta Algorithm,
when you get a meta for the entity ID from the network,
you must verify it with the consensus algorithm before accept it:

```
network = MKMNetwork_Main;
CT      = meta.fingerprint;
PK      = meta.key;
name    = meta.seed;
address = HASH(CT, network);

if (ID.name == name && ID.address == address && verify(name, CT, PK)) {
    correct = true;
} else {
    correct = false;
}
```

## 2. Message

### 2.0. Envelope

```
{
    sender   : "moki@4LrJHfGgDD6Ui3rWbPtftFabmN8damzRsi",
    receiver : "hulk@4bejC3UratNYGoRagiw8Lj9xJrx8bq6nnN",
    time     : 1541945151
}
```

### 2.1. Message Content

````
{
    type     : 0x01,       // message type
    sn       : 2704590558, // serial number (ID)
    
    text     : "Hey girl!"
}
````

#### Message Type

````
enum {
    DIMMessageType_Unknown = 0x00,
    DIMMessageType_Text    = 0x01,
    
    DIMMessageType_File    = 0x10,
    DIMMessageType_Image   = 0x12,
    DIMMessageType_Audio   = 0x14,
    DIMMessageType_Video   = 0x16,
    
    DIMMessageType_Page    = 0x20,
    
    // quote a message before and reply it with text
    DIMMessageType_Quote   = 0x37,
    
    // system command
    DIMMessageType_Command = 0x88,
    
    // top-secret message forward by proxy
    DIMMessageType_Forward = 0xFF
}
````

### 2.2. Message

#### Instant Message

````
{
    //-------- head (envelope) --------
    sender   : "moki@4LrJHfGgDD6Ui3rWbPtftFabmN8damzRsi",
    receiver : "hulk@4bejC3UratNYGoRagiw8Lj9xJrx8bq6nnN",
    time     : 1541945151,
    
    //-------- body (content) ---------
    content  : {
        type : 0x01,       // message type
        sn   : 2704590558, // serial number (ID)
        text : "Hey girl!"
    }
    
}
````

#### Secure Message

```
/**
 *  Algorithm:
 *      json = json(content);
 *      PW   = random();
 *      data = base64(encrpyt(json, PW));        // Symmetric
 *      key  = base64(encrypt(PW, receiver.PK)); // Asymmetric
 */
{
    //-------- head (envelope) --------
    sender   : "moki@4LrJHfGgDD6Ui3rWbPtftFabmN8damzRsi",
    receiver : "hulk@4bejC3UratNYGoRagiw8Lj9xJrx8bq6nnN",
    time     : 1541945151,
    
    //-------- body (content) ---------
    data     : "7UUPs5+5vT6UzXJVbsjEbgVrxQMCyi5rpGBVhyrjbfkB1MFrGof7c7NFk5lH0C0JHdaTg1Bdrnk/i/ee9kVnsjZFkTdSgct5wcqRj0sSQ7I=",
    key      : "ZDZRHCpJ0YC/HGQJNuYd8tGqqmzL6CjbFgafW73Fj8ZBcMyaMeDOVZjTXTXMP7iWzLVg1X2bX+FrfKOFztWJwmbqDbpxZVWzJgSc0qgMusu6fLUMRJMiIsASHp6ithu++8AjWDwHgcsM7sQekbA+YFjuFVO9T07AR5N1W5GTMQg="
}
```

#### Certified Message

```
/**
 *  Algorithm:
 *      ...
 *      signature = sign(data, sender.SK)
 */
{
    //-------- head (envelope) --------
    sender   : "moki@4LrJHfGgDD6Ui3rWbPtftFabmN8damzRsi",
    receiver : "hulk@4bejC3UratNYGoRagiw8Lj9xJrx8bq6nnN",
    time     : 1541945151,
    
    //-------- body (content) ---------
    data     : "7UUPs5+5vT6UzXJVbsjEbgVrxQMCyi5rpGBVhyrjbfkB1MFrGof7c7NFk5lH0C0JHdaTg1Bdrnk/i/ee9kVnsjZFkTdSgct5wcqRj0sSQ7I=",
    key      : "ZDZRHCpJ0YC/HGQJNuYd8tGqqmzL6CjbFgafW73Fj8ZBcMyaMeDOVZjTXTXMP7iWzLVg1X2bX+FrfKOFztWJwmbqDbpxZVWzJgSc0qgMusu6fLUMRJMiIsASHp6ithu++8AjWDwHgcsM7sQekbA+YFjuFVO9T07AR5N1W5GTMQg=",
    signature: "Vy9S+6+KgpczWsbzU97217XFoPIJtvHZb5mcShwx12IUnbU3I0voDMbt4O0HtATxQbUsK4pXxR63eGT8kH/9FwWVrNE5kgVXYHgAyan2cNOHJM+GRjNY+ZUIgDrvyBH3zRSEP/JcEJFO70Jp5ERY7LAo/BQPA5Upt3ZshF3SrzY="
}
```


---
Written by [Albert Moky](http://moky.github.com/) @2018
